# Lab 03\. Синхронізація в паралельних програмах

## Завдання

1. Проаналізуйте один із наведених нижче варіантів коду і вкажіть на можливі помилки.  
2. Створіть модульні тести (pytest), які покажуть наявність помилок. Один тест має перевіряти одну помилку  
3. Проаналізуйте важливість знайдених помилок.  
4. Виправте помилки.  
5. За допомогою тестів покажіть, що помилки виправлено.

Результатом роботи є jupyter notebook в  [Google Colab](https://colab.google/) або репозиторій на github, який містить завдання, початковий варіант коду із тестами, виправлений варіант коду із тестами, пояснення виправлень.

Рекомендується використовувати одну з LLM ([https://chatgpt.com/](https://chatgpt.com/) , [https://gemini.google.com/](https://gemini.google.com/) , [https://chat.deepseek.com/](https://chat.deepseek.com/) або іншу) для прискорення роботи. 

## Хід роботи

1. **Ознайомлення з теоретичними відомостями:**  Повторити основні механізми синхронізації в багатопоточних програмах (м’ютекси, семафори, умовні змінні, події, бар’єри, черги). Звернути увагу на типові проблеми: неправильне використання `acquire()/release()`, ігнорування інваріантів у `Condition`, відсутність обробки винятків у `Barrier`, блокування програми через очікування.

2. **Вибір прикладу коду:**  Обрати один із наданих варіантів програмного коду (наприклад, із використанням Lock, Semaphore чи Barrier).

3. **Аналіз початкового коду:** Уважно прочитати код і визначити можливі помилки у використанні механізмів синхронізації. Приклади:  
    – гонка даних через відсутність блокування;  
    – deadlock через неправильний порядок викликів;  
    – неправильне використання `Condition` без циклу `while`;  
    – невраховані винятки `BrokenBarrierError`;  
    – утримання блокування занадто довго.

4. **Формулювання переліку помилок:** Скласти чіткий список проблем. Для кожної вказати: де саме в коді вона виникає, чому це помилка, які наслідки для багатопоточної програми.

5. **Створення модульних тестів (pytest):** Для кожної виявленої помилки створити окремий тест. Один тест \= одна помилка. Тест має демонструвати неправильну поведінку (наприклад, зависання, неправильний результат, непередбачувані значення).

6. **Аналіз важливості помилок:**  Для кожної проблеми оцінити її серйозність: наскільки критично вона впливає на коректність чи продуктивність програми.

7. **Виправлення коду:** Внести у програму необхідні зміни відповідно до порад:  
    – мінімізувати час утримання блокувань;  
    – використовувати `finally` для парності `acquire()/release()`;  
    – у `Condition` перевіряти інваріант у циклі `while`;  
    – обробляти `BrokenBarrierError`;  
    – за потреби замінити обмін даними на `Queue`.

8. **Перевірка виправленої версії:** Запустити ті ж самі тести на виправленому коді й переконатися, що тепер усі проходять успішно.

9. **Оформлення результатів:** Підготувати Jupyter Notebook у Google Colab або репозиторій GitHub, що містить:  
    – завдання та початковий варіант коду;  
    – набір тестів, які демонструють помилки;  
    – виправлений код;  
    – тести для перевірки виправленого варіанту;  
    – пояснення знайдених помилок і обґрунтування внесених виправлень.

10. **Фінальний аналіз і висновки:** Підсумувати, які помилки були знайдені, чому вони виникають у багатопоточних програмах, як були виправлені, і які уроки варто врахувати для уникнення їх у майбутніх розробках.

